sudo: required
services:
    - docker
# env:
#     global:
#         - SHA=$(git rev-parse HEAD)
#         - CLOUDSDK_CORE_DISABLE_PROMPTS=1

install:
    - echo "$DOCKER_PW" | docker login -u "DOCKER_ID" â€“password-stdin
    - mkdir ${HOME}/.kube
    - cp ./k8s/config.yaml ${HOME}/.kube/config
    - cd ${HOME}/.kube
    - sed -i 's/KUBE_CLUSTER_NAME/'"$KUBE_CLUSTER_NAME"'/g' config
    - sed -i 's/KUBE_CLUSTER_CERTIFICATE/'"$KUBE_CLUSTER_CERTIFICATE"'/g' config
    - sed -i 's/KUBE_CLIENT_CERTIFICATE/'"$KUBE_CLIENT_CERTIFICATE"'/g' config
    - sed -i 's/KUBE_CLIENT_KEY/'"$KUBE_CLIENT_KEY"'/g' config
    - sed -i 's/KUBE_ADMIN_PWD/'"$KUBE_ADMIN_PWD"'/g' config
    - kubectl config use-context $KUBE_CLUSTER_NAME
    - cd $TRAVIS_BUILD_DIR
    # - docker build -t $DOCKER_ID/client-test -f ./client/Dockerfile.dev ./client
    # - docker build -t $DOCKER_ID/api-test -f ./api/Dockerfile.dev ./api

scripts:
    - kubectl get pods
    # - docker run -e CI=true $DOCKER_ID/client-test npm run test
    # - docker run -e CI=true $DOCKER_ID/api-test npm run test

# deploy:
#     provider: script
#     script: bash ./deploy.sh
#     on:
#         branch: master


